 <!DOCTYPE html>
 <html lang="en">
 <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | MoniToons</title>
    <link rel="stylesheet" href="css/style_formularios.css">
    <link rel="stylesheet" href="assets/fontes/fonts.css">
    <link rel="icon" type="image/png" href="assets/moon.png"/>
    <script src="https://kit.fontawesome.com/c52875e8e8.js" crossorigin="anonymous"></script>
    <script src="js/mostrarSenhas.js"></script>
    <script src="js/validarSessao.js"></script>
 </head>
 <body>
    <div class="div_central">
        <nav>
            <div class="borda_do_botao">
            <button class="voltar" onclick="redirecionar()">Voltar</button>
            </div>
        </nav>
        <div class="cartao_logar" id="cartao_logar">
            <form action="" class="formulario_generico">
                <h1 class="texto_login">Faça o login com sua conta!</h1>
                <div class="input_diferente">
                    <i class="fa-solid fa-user fa-xl icone"></i>
                    <input id="inputEmail" type="text" placeholder="Email">
                </div>
                <div class="input_diferente">
                    <i class="fa-solid fa-lock fa-xl icone"></i>
                    <input id="inputSenha" type="password" placeholder="Senha" class="input_senha">
                    <i class="fa-solid fa-eye-slash icone" onclick="mostrarSenha()" id="icone_olho"></i>
                </div>
                <button  onclick="entrar()" class="botao_entrar" type="button">LOGIN</button>
                <a onclick="mudaSenha()">Esqueceu a senha?</a>
            </form>

        </div>
    </div>

 </body>
 </html>
 <script>
    function entrar(){
        var email = inputEmail.value;
        var senha = inputSenha.value;

        if(email == "" || senha == ""){
            alert("Campos Vazios!")
        }else if (!email.includes("@")){
            alert("Email inválido!")
        }else if(senha.length < 8){
            alert("Senha curta demais!")
        }else{
            fetch("/usuarios/autenticar",{
                method: "POST",
                headers:{
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    email,
                    senha
                })
            }).then(function (resposta){
                console.log("Estamos no THEN")

                if(resposta.ok){
                    console.log(resposta);

                    resposta.json().then(json => {
                        console.log(json);
                        console.log(JSON.stringify(json));

                        sessionStorage.EMAIL_USUARIO = json.email;
                        sessionStorage.NOME_USUARIO = json.nome;
                        sessionStorage.CARGO_USUARIO = json.cargo;
                        sessionStorage.ID_USUARIO = json.idUsuario;
                        sessionStorage.FK_EMPRESA = json.fkEmpresa;

                        setTimeout(function(){

                            if(json.cargo == "Administrador"){
                                window.location = "./dashboard/maquinas.html"
                            }else{
                                window.location = "./dashboard/dashboard.html"
                            }

                        },1000);
                    })
                } else {
                    alert("Login não existente!")
                    console.log("Login não existente!");

                    resposta.text().then(texto => {
                        console.error(texto);
                    });
                }
            }).catch(function(erro){
                console.log(erro);
            })
        }

    }

    function redirecionar(){
        window.location.href = "index.html"
    };
    function mudaSenha(){
        cartao_logar.innerHTML = `

        <form action="" class="formulario_generico">
            <h1 class="texto_login">Digite o seu email para recuperar sua senha</h1>
            <div class="input_diferente">
                    <i class="fa-solid fa-envelope fa-xl icone"></i>
                    <input type="text" placeholder="Email">
            </div>
            <button class="botao_entrar" onclick="enviarEmail()">Recuperar senha</button>
            <a href="">Voltar</a>
        </form>
        `
    }
    function enviarEmail(){
        cartao_logar.innerHTML = `
        <form action="" class="formulario_generico">
            <h1 class="texto_login">Enviamos um email para o endereço fornecido. Para recuperar sua senha siga o passo a passo enviado no email</h1>
            <button class="botao_entrar" onclick="voltar()">Voltar</button>
        </form>
        `
    }
 </script>
