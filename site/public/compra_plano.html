<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assinar | MoniToons</title>
    <link rel="stylesheet" href="css/style_formularios.css">
    <link rel="stylesheet" href="css/style_barra.css">
    <link rel="stylesheet" href="assets/fontes/fonts.css">
    <link rel="icon" type="image/png" href="assets/moon.png" />
    <script src="https://kit.fontawesome.com/c52875e8e8.js" crossorigin="anonymous"></script>
    <script src="js/mostrarSenhas.js"></script>
    <script src="js/formulario.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
</head>

<body>
    <div class="bloqueio">
        <h1 class="texto_compra" style="color: white;">
            Desculpe, só é possível realizar a assinatura por um computador
        </h1>
    </div>
    <div class="div_central">
        <nav>
            <div class="borda_do_botao">
                <button class="voltar" onclick="redirecionar()">Voltar</button>
            </div>
        </nav>

        <div class="cartao" id="cartao_logar">
            <ol id="barra-controle-personalizado" class="large">
                <li>Cadastro</li>
                <li>Pagamento</li>
                <li>Login</li>
            </ol>
            <form id="formulario_compra">

                <div id="div_campos_formulario">

                    <h1 class="texto_compra">Preencha os campos para assinar o serviço Monitoons</h1>

                    <div class="mesma_linha">
                        <input type="button" class="muda_dados botao_ativado" onclick="mudaPessoa(1)"
                            value="Pessoa Física">
                        <input type="button" class="muda_dados" id="botao" onclick="mudaPessoa(2)"
                            value="Pessoa Jurídica">
                    </div>

                    <div class="mesma_linha">
                        <div class="campo_simples">
                            <h2 class="label">Nome </h2>
                            <input type="text" class="input" onfocus="subirLabel(1)" onfocusout="descerLabel(1)"
                                onkeyup="validarNome(this)" id="input_nome">
                            <div class="tooltip" id="tooltip-nome">Preencha o nome corretamente.</div>
                        </div>
                        <div class="campo_simples">
                            <h2 class="label">Sobrenome</h2>
                            <input type="text" class="input" onfocus="subirLabel(2)" onfocusout="descerLabel(2)"
                                onkeyup="validarSobrenome(this)" id="input_sobrenome">
                            <div class="tooltip" id="tooltip-sobrenome">Preencha o sobrenome corretamente.</div>
                        </div>
                    </div>

                    <div class="campo_maior">
                        <h2 class="label">Email</h2>
                        <input type="text" class="input" onfocus="subirLabel(3)" onfocusout="descerLabel(3)"
                            onkeyup="validarEmail(this)" id="input_email">
                        <div class="tooltip" id="tooltip-email">Preencha um email válido.</div>
                    </div>

                    <div class="mesma_linha">
                        <div class="campo_simples">
                            <h2 class="label">Senha</h2>
                            <input type="password" id="input_senha" class="input_senha input"
                                onkeyup="validarSenha(this)" onfocus="subirLabel(4)" onfocusout="descerLabel(4)">
                            <i class="fa-solid fa-eye-slash icone" onclick="mostrarSenha()" id="icone_olho"></i>
                            <div class="tooltip" id="tooltip-senha">A senha deve ter pelo menos 8 caracteres.</div>
                        </div>
                        <div class="campo_simples">
                            <h2 class="label">Confirmar senha</h2>
                            <input type="password" class="input_senha input" onkeyup="validarConfirmacaoSenha(this)"
                                id="input_confirmar_senha" onfocus="subirLabel(5)" onfocusout="descerLabel(5)">
                            <i class="fa-solid fa-eye-slash icone" onclick="mostrarSenha()" id="icone_olho"></i>
                            <div class="tooltip" id="tooltip-confirmar-senha">As senhas não coincidem.</div>
                        </div>
                    </div>

                    <div class="mesma_linha">
                        <div class="campo_simples">
                            <h2 class="label" id="label_rg_nome_fantasia">RG</h2>
                            <input type="text" class="input" onfocus="subirLabel(6)" onfocusout="descerLabel(6)"
                                onkeyup="validarRG(this)" id="input_rg_nome_fantasia">
                            <div class="tooltip" id="tooltip-rg">Preencha o RG corretamente.</div>
                        </div>
                        <div class="campo_simples">
                            <h2 class="label" id="label_cpf_cnpj">CPF</h2>
                            <input type="text" class="input" onfocus="subirLabel(7)" onfocusout="descerLabel(7)"
                                onkeyup="validarCPF(this)" id="input_cpf_cnpj">
                            <div class="tooltip" id="tooltip-cpf">Preencha o CPF corretamente.</div>
                        </div>
                    </div>
                </div>

                <div id="controle">

                </div>

            </form>
        </div>
    </div>

</body>

</html>
<script>
    var paginaDoFormulario = 0;

    function redirecionar() {
        window.location.href = "index.html"
    };

    /* Seção barra de progresso assinatura */

    jQuery.fn.extend({
        stepProgressBar: function (currentStep) {
            currentStep = currentStep || this.currentStep() || 1;
            let childs = this
                .addClass("step-progress-bar")
                .find("li")
                .removeClass("step-past step-present step-future");

            childs.find(".content-stick").removeClass("step-past step-future");

            let size = childs.length < 1 ? 100 : 100 / childs.length;
            childs.css("width", size + "%");

            for (let i = 0; i < childs.length; i++) {
                let child = $(childs[i]);
                if (child.find("span.content-wrapper").length === 0) {
                    child.wrapInner("<span class='content-wrapper'></span>");
                    if (i > 0) child.append("<span class='content-stick'></span>");
                    child.prepend("<span class='content-bullet'>" + (i + 1) + "</span>");
                }
                let stepName = i < currentStep - 1 ? "step-past"
                    : i === currentStep - 1 ? "step-present"
                        : "step-future";
                child.addClass(stepName);
                if (i > 0) {
                    let stickName = stepName === "step-present" ? "step-past" : stepName;
                    child.find(".content-stick").addClass(stickName);
                }
                child.css("z-index", childs.length - i);
                child.find(":before").css("z-index", childs.length - i + 2);
            }
            return this;
        },

        currentStep: function () {
            var childs = this.find("li");
            for (let i = 0; i < childs.length; i++) {
                if ($(childs[i]).is(".step-present")) return i + 1;
            }
            return 1;
        },

        countSteps: function () {
            return this.find("li").length;
        },

        isLastStep: function () {
            return this.countSteps() === this.currentStep();
        },


        nextStep: function () {
            if (!this.isLastStep()) {

                if (paginaDoFormulario == 0) {
                    var resultadoValidacao = validarFormulario();

                    if (resultadoValidacao) {
                        this.stepProgressBar(this.currentStep() + 1);
                        formularioPagamento();
                        paginaDoFormulario++
                    }
                } else if (paginaDoFormulario == 1) {
                    var resultadoPagamento = validarPagamento();
                    if (resultadoPagamento) {
                        this.stepProgressBar(this.currentStep() + 1);
                        formularioPagamento();
                        paginaDoFormulario++;
                    }
                }
            }
        },

        controlProgressBar: function (progressBar) {
            let next = function () { progressBar.nextStep() };
            this.empty();
            $("<button type='button' id='button_continuar' class='botao_acao next'>Continuar</button>").on('click', next).appendTo(this);
            $("<button type='button' id='button_finalizar' class='botao_acao next'>Finalizar</button>")
                .on('click', next).appendTo(this);


            return this;
        }
    });

    /* JavaScript na página. */

    let ca = $("#barra-controle-personalizado").stepProgressBar(1);
    let cb = $("#controle").controlProgressBar(ca);
    cb.find(".rewind, .fast-forward").remove();


    /* Seção configuração de formulário */

    var botaoContinuar = document.getElementById("button_continuar")
    var botaoFinalizar = document.getElementById("button_finalizar")
    var formulario = document.getElementById("formulario_compra")

    /* Campos formulário */

    var usuario = {
        nomeCompleto: "",
        email: "",
        senha: "",
        cpf: "",
        rg: "",
        cnpj: "",
        nomeFantasia: "",
        planoAdquirido: ""
    }

    /* Eveng */

    botaoContinuar.addEventListener("click", function (event) {

        usuario.nomeCompleto = input_nome.value + " " + input_sobrenome.value;
        usuario.email = input_email.value;
        usuario.senha = input_senha.value;

        var tipoPessoaSelecionado = document.querySelector(".botao_ativado");

        if (tipoPessoaSelecionado.value === "Pessoa Física") {
            usuario.cpf = input_cpf_cnpj.value;
            usuario.rg = input_rg_nome_fantasia.value;

        } else if (tipoPessoaSelecionado.value === "Pessoa Jurídica") {
            cnpj = document.querySelector("#label_cpf_cnpj").textContent;
            nomeFantasia = input_rg_nome_fantasia.value;
        }

    });

    botaoFinalizar.addEventListener("click", function (event) {

        var plano = document.querySelector("input[name='plano']:checked")

        usuario.planoAdquirido = plano[0];

        fetch('/usuarios/cadastrar', {
            method: 'POST',
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(usuario)

        }).then(response => {
            if (!response.ok) {
                throw new Error('Erro na solicitação POST');
            }
            return response.text();
        })
            .then(data => {
                console.log('Resposta do servidor:', data);
            })
            .catch(error => {
                console.error('Erro:', error);
            })
    })

</script>